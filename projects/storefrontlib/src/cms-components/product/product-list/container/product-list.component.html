<div class="cx-page" *ngIf="model">
  <section class="cx-page-section">
    <div class="container">
      <div class="row">
        <div class="col-12 col-lg-12" *ngIf="(viewMode$ | async) as viewMode">
          <div class="cx-sorting top">
            <div class="row">
              <div class="col-12 col-lg-4 mr-auto">
                <div class="form-group cx-sort-dropdown">
                  <cx-sorting
                    [sortOptions]="model.sorts"
                    (sortListEvent)="sortList($event)"
                    [selectedOption]="model.pagination.sort"
                    placeholder="{{
                      'productList.sortByRelevance' | cxTranslate
                    }}"
                  ></cx-sorting>
                </div>
              </div>
              <div *ngIf="!isInfiniteScroll" class="col-auto">
                <div
                  class="cx-pagination"
                  aria-label="product search pagination"
                >
                  <cx-pagination
                    [pagination]="model.pagination"
                    (viewPageEvent)="viewPage($event)"
                  ></cx-pagination>
                </div>
              </div>
              <div class="col-auto ml-auto ml-lg-0">
                <cx-product-view
                  (modeChange)="setViewMode($event)"
                  [mode]="viewMode"
                ></cx-product-view>
              </div>
            </div>
          </div>
          <div class="cx-product-container">
            <ng-container *ngIf="viewMode === ViewModes.Grid">
              <div
                infiniteScroll
                [infiniteScrollDistance]="5"
                [infiniteScrollThrottle]="50"
                [infiniteScrollDisabled]="
                  !isInfiniteScroll || isMaxProducts || isLastPage || isEmpty
                "
                (scrolled)="scrollPage(model.pagination.currentPage + 1)"
              >
                <div class="row">
                  <cx-product-grid-item
                    *ngFor="let product of model?.products"
                    [product]="product"
                    class="col-12 col-sm-6 col-md-4"
                  ></cx-product-grid-item>
                </div>
                <div
                  style="display: flex; justify-content: center; padding-top: 25px"
                >
                  <p>
                    <a
                      *ngIf="isMaxProducts || isLastPage"
                      (click)="scrollToTop()"
                      class="btn-link back-to-top cx-scroll-buttons"
                      >BACK TO TOP</a
                    >
                  </p>
                  <p>
                    <a
                      *ngIf="isMaxProducts && !isLastPage"
                      (click)="loadNextPage(model?.pagination?.currentPage + 1)"
                      class="btn-link show-more cx-scroll-buttons"
                      >SHOW MORE</a
                    >
                  </p>
                </div>
                <div *ngIf="isLoadingItems" class="cx-spinner">
                  <cx-spinner></cx-spinner>
                </div>
              </div>
            </ng-container>

            <ng-container *ngIf="viewMode === ViewModes.List">
              <div
                infiniteScroll
                [infiniteScrollDistance]="3"
                [infiniteScrollThrottle]="50"
                [infiniteScrollDisabled]="
                  !isInfiniteScroll || isMaxProducts || isLastPage || isEmpty
                "
                (scrolled)="scrollPage(model.pagination.currentPage + 1)"
              >
                <cx-product-list-item
                  *ngFor="let product of model?.products"
                  [product]="product"
                  class="cx-product-search-list"
                ></cx-product-list-item>
                <div style="display: flex; justify-content: center;">
                  <p>
                    <a
                      *ngIf="isMaxProducts || isLastPage"
                      (click)="scrollToTop()"
                      class="btn-link back-to-top cx-scroll-buttons"
                      >BACK TO TOP</a
                    >
                  </p>
                  <p>
                    <a
                      *ngIf="isMaxProducts && !isLastPage"
                      (click)="loadNextPage(model?.pagination?.currentPage + 1)"
                      class="btn-link show-more cx-scroll-buttons"
                      >SHOW MORE</a
                    >
                  </p>
                </div>
                <div *ngIf="isLoadingItems" class="cx-spinner">
                  <cx-spinner></cx-spinner>
                </div>
              </div>
            </ng-container>
          </div>
          <div class="cx-sorting bottom">
            <div class="row">
              <div class="col-12 col-lg-4 mr-auto">
                <div class="form-group cx-sort-dropdown">
                  <cx-sorting
                    [sortOptions]="model.sorts"
                    (sortListEvent)="sortList($event)"
                    [selectedOption]="model.pagination.sort"
                    placeholder="{{
                      'productList.sortByRelevance' | cxTranslate
                    }}"
                  ></cx-sorting>
                </div>
              </div>
              <div
                *ngIf="!isInfiniteScroll"
                class="col-auto"
                aria-label="product search pagination"
              >
                <div class="cx-pagination">
                  <cx-pagination
                    [pagination]="model.pagination"
                    (viewPageEvent)="viewPage($event)"
                  ></cx-pagination>
                </div>
              </div>
              <div class="col-auto ml-auto ml-lg-0">
                <cx-product-view
                  (modeChange)="setViewMode($event)"
                  [mode]="viewMode"
                ></cx-product-view>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
